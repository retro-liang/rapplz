CREATE DATABASE IF NOT EXISTS rapplz;
GRANT ALL PRIVILEGES ON rapplz.* TO root@localhost IDENTIFIED BY 'admin';

USE rapplz;

---------------------------------------------
DROP TABLE IF EXISTS tag;
DROP TABLE IF EXISTS tag_name;
DROP TABLE IF EXISTS review_comment;
DROP TABLE IF EXISTS review;
DROP TABLE IF EXISTS app_comment;
DROP TABLE IF EXISTS recommendation;
DROP TABLE IF EXISTS follower_following;
DROP TABLE IF EXISTS activity;
DROP TABLE IF EXISTS user;
DROP TABLE IF EXISTS account_type;
DROP TABLE IF EXISTS account_role;
DROP TABLE IF EXISTS account_status;
DROP TABLE IF EXISTS screenshot;
DROP TABLE IF EXISTS app_category;
DROP TABLE IF EXISTS category;
DROP TABLE IF EXISTS app_device;
DROP TABLE IF EXISTS device;
DROP TABLE IF EXISTS app;
DROP TABLE IF EXISTS os;
---------------------------------------------

CREATE TABLE IF NOT EXISTS os
(
	id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	name VARCHAR(20) NOT NULL,
	created_date TIMESTAMP NOT NULL DEFAULT NOW(),
	modified_date DATETIME,
	INDEX(name)
)ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS app
(
	id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	raw_id VARCHAR(255) NOT NULL,
	name VARCHAR(80) NOT NULL,
	description TEXT,
	os_id INT UNSIGNED NOT NULL,
	app_store_url VARCHAR(255) NOT NULL,
	icon_url VARCHAR(255) NOT NULL, 
	price DECIMAL,
	version VARCHAR(10),
	company_id VARCHAR(80),
	company_name VARCHAR(80),
	company_url VARCHAR(80),
	release_date VARCHAR(30),
	app_store_rating REAL,
	app_store_rating_count INT UNSIGNED,
	created_date TIMESTAMP NOT NULL DEFAULT NOW(),
	modified_date DATETIME,
	FOREIGN KEY (os_id) REFERENCES os(id),
	INDEX(name)
)ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS device
(
	id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	name VARCHAR(20) NOT NULL,
	created_date TIMESTAMP NOT NULL DEFAULT NOW(),
	modified_date DATETIME,
	INDEX(name)
)ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS app_device
(
	id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	app_id BIGINT UNSIGNED NOT NULL,
	device_id INT UNSIGNED NOT NULL,
	FOREIGN KEY (app_id) REFERENCES app(id),
	FOREIGN KEY (device_id) REFERENCES device(id)
)ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS category
(
	id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	name VARCHAR(20) NOT NULL,
	created_date TIMESTAMP NOT NULL DEFAULT NOW(),
	modified_date DATETIME,
	INDEX(name)
)ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS app_category
(
	id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	app_id BIGINT UNSIGNED NOT NULL,
	category_id INT UNSIGNED NOT NULL,
	FOREIGN KEY (app_id) REFERENCES app(id),
	FOREIGN KEY (category_id) REFERENCES category(id)
)ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS screenshot
(
	id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	app_id BIGINT UNSIGNED NOT NULL,
	type VARCHAR(20) NOT NULL,
	url VARCHAR(255) NOT NULL,
	created_date TIMESTAMP NOT NULL DEFAULT NOW(),
	modified_date DATETIME,
	FOREIGN KEY (app_id) REFERENCES app(id),
	INDEX(app_id)
)ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS account_type
(
	id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	name VARCHAR(20) NOT NULL,
	created_date TIMESTAMP NOT NULL DEFAULT NOW(),
	modified_date DATETIME,
	INDEX(name)
)ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS account_role
(
	id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	name VARCHAR(20) NOT NULL,
	created_date TIMESTAMP NOT NULL DEFAULT NOW(),
	modified_date DATETIME,
	INDEX(name)
)ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS account_status
(
	id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	name VARCHAR(20) NOT NULL,
	created_date TIMESTAMP NOT NULL DEFAULT NOW(),
	modified_date DATETIME,
	INDEX(name)
)ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS user
(
	id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	account_type_id INT UNSIGNED NOT NULL,
	account_role_id INT UNSIGNED NOT NULL,
	account_status_id INT UNSIGNED NOT NULL,
	email VARCHAR(80) NOT NULL,
	password VARCHAR(30) NOT NULL,
	first_name VARCHAR(30),
	last_name VARCHAR(30),
	created_date TIMESTAMP NOT NULL DEFAULT NOW(),
	modified_date DATETIME,
	FOREIGN KEY (account_type_id) REFERENCES account_type(id),
	FOREIGN KEY (account_status_id) REFERENCES account_status(id),
	INDEX(email,first_name)
)ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS activity
(
	id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	user_id BIGINT UNSIGNED NOT NULL,
	activity_type VARCHAR(20) NOT NULL,
	activity_result VARCHAR(20) NOT NULL,
	content VARCHAR(255) NOT NULL,
	created_date TIMESTAMP NOT NULL DEFAULT NOW(),
	modified_date DATETIME,
	FOREIGN KEY (user_id) REFERENCES user(id),
	INDEX(user_id,activity_type,activity_result)
)ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS follower_following
(
	id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	follower_user_id BIGINT UNSIGNED NOT NULL,
	following_user_id BIGINT UNSIGNED NOT NULL,
	created_date TIMESTAMP NOT NULL DEFAULT NOW(),
	modified_date DATETIME,
	FOREIGN KEY (follower_user_id) REFERENCES user(id),
	FOREIGN KEY (following_user_id) REFERENCES user(id),
	INDEX(follower_user_id,following_user_id)
)ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS recommendation
(
	id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	app_id BIGINT UNSIGNED NOT NULL,
	from_user_id BIGINT UNSIGNED NOT NULL,
	to_user_id BIGINT UNSIGNED NOT NULL,
	message TEXT,
	created_date TIMESTAMP NOT NULL DEFAULT NOW(),
	modified_date DATETIME,
	FOREIGN KEY (app_id) REFERENCES app(id),
	FOREIGN KEY (from_user_id) REFERENCES app(id),
	FOREIGN KEY (to_user_id) REFERENCES app(id),
	INDEX(app_id,from_user_id,to_user_id)
)ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS app_comment
(
	id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	author_user_id BIGINT UNSIGNED NOT NULL,
	app_id BIGINT UNSIGNED NOT NULL,
	content TEXT NOT NULL,
	created_date TIMESTAMP NOT NULL DEFAULT NOW(),
	modified_date DATETIME,
	FOREIGN KEY (author_user_id) REFERENCES user(id),
	FOREIGN KEY (app_id) REFERENCES app(id),
	INDEX(app_id,author_user_id)
)ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS review
(
	id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	author_user_id BIGINT UNSIGNED NOT NULL,
	app_id BIGINT UNSIGNED NOT NULL,
	content TEXT NOT NULL,
	created_date TIMESTAMP NOT NULL DEFAULT NOW(),
	modified_date DATETIME,
	FOREIGN KEY (author_user_id) REFERENCES user(id),
	FOREIGN KEY (app_id) REFERENCES app(id),
	INDEX(app_id,author_user_id)
)ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS review_comment
(
	id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	author_user_id BIGINT UNSIGNED NOT NULL,
	review_id BIGINT UNSIGNED NOT NULL,
	content TEXT NOT NULL,
	created_date TIMESTAMP NOT NULL DEFAULT NOW(),
	modified_date DATETIME,
	FOREIGN KEY (author_user_id) REFERENCES user(id),
	FOREIGN KEY (review_id) REFERENCES review(id),
	INDEX(author_user_id,review_id)
)ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS tag_name
(
	id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	name VARCHAR(20) NOT NULL,
	created_date TIMESTAMP NOT NULL DEFAULT NOW(),
	modified_date DATETIME,
	INDEX(name)
)ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS tag
(
	id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	author_user_id BIGINT UNSIGNED NOT NULL,
	app_id BIGINT UNSIGNED NOT NULL,
	tag_name_id BIGINT UNSIGNED NOT NULL,
	created_date TIMESTAMP NOT NULL DEFAULT NOW(),
	modified_date DATETIME,
	FOREIGN KEY (author_user_id) REFERENCES user(id),
	FOREIGN KEY (app_id) REFERENCES app(id),
	FOREIGN KEY (tag_name_id) REFERENCES tag_name(id),
	INDEX(author_user_id,tag_name_id)
)ENGINE=InnoDB;